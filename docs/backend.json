{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CloudGuard AI application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user entity."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "displayName": {
          "type": "string",
          "description": "Display name of the user."
        },
        "photoURL": {
          "type": "string",
          "description": "URL of the user's profile picture.",
          "format": "uri"
        },
        "subscriptionPlan": {
          "type": "string",
          "description": "The user's current subscription plan (e.g., 'free', 'pro')."
        },
        "notificationPreferences": {
          "type": "string",
          "description": "Notification preferences of the user, stored as a JSON string."
        }
      },
      "required": [
        "id",
        "email",
        "displayName"
      ]
    },
    "Alert": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Alert",
      "type": "object",
      "description": "Represents an alert generated by the AI risk engine.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the alert entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Alert)"
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp when the alert was generated.",
          "format": "date-time"
        },
        "riskLevel": {
          "type": "string",
          "description": "Risk level associated with the alert (e.g., 'Low', 'Medium', 'High')."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the alert."
        },
        "logFileId": {
          "type": "string",
          "description": "Reference to LogFile. (Relationship: LogFile 1:N Alert)"
        }
      },
      "required": [
        "id",
        "userId",
        "timestamp",
        "riskLevel",
        "description"
      ]
    },
    "LogFile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "LogFile",
      "type": "object",
      "description": "Represents a log file uploaded for analysis.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the log file entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N LogFile)"
        },
        "uploadTimestamp": {
          "type": "string",
          "description": "Timestamp when the log file was uploaded.",
          "format": "date-time"
        },
        "fileName": {
          "type": "string",
          "description": "Original name of the uploaded log file."
        },
        "fileType": {
          "type": "string",
          "description": "Type of the uploaded log file (e.g., 'JSON', 'CSV')."
        },
        "fileSize": {
          "type": "number",
          "description": "Size of the uploaded log file in bytes."
        }
      },
      "required": [
        "id",
        "userId",
        "uploadTimestamp",
        "fileName",
        "fileType",
        "fileSize"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profile data. Uses path-based ownership for security.  The 'userId' parameter identifies the user document.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/logFiles/{logFileId}",
        "definition": {
          "entityName": "LogFile",
          "schema": {
            "$ref": "#/backend/entities/LogFile"
          },
          "description": "Stores log files uploaded by each user. Located under the user's document to establish clear ownership, with path-based security rules. The 'userId' and 'logFileId' parameters identify the log file.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "logFileId",
              "description": "The unique identifier of the log file."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/logFiles/{logFileId}/alerts/{alertId}",
        "definition": {
          "entityName": "Alert",
          "schema": {
            "$ref": "#/backend/entities/Alert"
          },
          "description": "Stores alerts generated from log file analysis. Nested under the log files to inherit ownership and maintain data locality. The 'userId', 'logFileId', and 'alertId' parameters identify the alert.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            },
            {
              "name": "logFileId",
              "description": "The unique identifier of the log file."
            },
            {
              "name": "alertId",
              "description": "The unique identifier of the alert."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and ease of debugging, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. The core strategy involves denormalization of authorization data to avoid `get()` calls in security rules and structural segregation to maintain homogeneous security postures within collections.\n\n1.  **Users Collection (`/users/{userId}`):** Stores user profiles. Path-based ownership ensures that only the authenticated user can access their data.\n2.  **LogFiles Subcollection (`/users/{userId}/logFiles/{logFileId}`):** Stores log files uploaded by each user. Located under the user's document to establish clear ownership, with path-based security rules. Authorization context (userId) is inherited via the path. This structure supports QAPs because list operations are scoped to the user.\n3.  **Alerts Subcollection (`/users/{userId}/logFiles/{logFileId}/alerts/{alertId}`):** Stores alerts generated from log file analysis. Nested under the log files to inherit ownership and maintain data locality. Includes the `userId` in each document for Authorization Independence. Supports QAPs because listing alerts is scoped to the user's log files."
  }
}